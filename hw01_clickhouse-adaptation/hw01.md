# ![ClickHouse](https://miro.medium.com/v2/resize:fit:1200/1*Wqd2cFYbLVeYXfCSNDhedA.png)

# Homework #1: Адаптация ClickHouse

## Цель: В результате выполнения ДЗ вы познакомитесь с применением ClickHouse в коммерческих проектах и лучше поймете возможности использования ClickHouse в различных архитектурных решениях.

Необходимо привести 2-3 примера использования ClickHouse в компаниях на рынке, уточнить специфику проекта и подготовить отчет с описанием особенностей внедрения и архитектуры.

ДЗ сдается ссылкой на гит, где расположен мини-отчет в маркдауне.

Критерии оценки:
* Задание считается выполненным, если вы выполнили все действия, описанные выше.

---

## Решение

ClickHouse активно используется в различных коммерческих проектах для решения задач аналитики больших данных в режиме реального времени. Рассмотрим три наиболее показательных примера внедрения этой колоночной СУБД в крупных технологических компаниях.

### **1. Cloudflare - HTTP и DNS аналитика**

**Специфика проекта:**
Cloudflare использует ClickHouse для обработки HTTP аналитики при обработке 6 миллионов запросов в секунду. Компания является одним из первых пользователей ClickHouse, внедрив его в продакшн уже в конце 2016 года, сразу после открытия исходного кода.

**Особенности внедрения:**
- **Масштаб операций:** Обработка сотен миллионов строк в секунду
- **Архитектурное решение:** Замена предыдущего решения на базе PostgreSQL и CitusDB
- **Случаи использования:**
  - HTTP и DNS аналитика для мониторинга веб-трафика
  - Анализ логов и управление трафиком/ботами
  - Аналитика среды выполнения Cloudflare Workers
  - Внутренние аналитические нагрузки
  - Пользовательские дашборды в реальном времени
  - Аналитика брандмауэра и Cloudflare Radar

**Архитектурные особенности:**
- Использование колоночного хранения для эффективной агрегации данных
- Интеграция с системами словарей для обогащения данных
- Распределенная архитектура с горизонтальным масштабированием
- Асинхронная репликация для обеспечения отказоустойчивости

### **2. Uber - Инфраструктура логирования**

**Специфика проекта:**
Uber использует ClickHouse для замены ElasticSearch в своей системе логирования, обрабатывая миллионы логов в секунду от тысяч микросервисов.

**Проблемы, решаемые ClickHouse:**
- **Производительность разработчиков:** ElasticSearch требовал консистентной схемы на индекс, что создавало конфликты типов
- **Производительность системы:** Высокая задержка при индексации и плохая производительность запросов
- **Масштабируемость:** Высокие эксплуатационные расходы и проблемы надежности ES

**Особенности внедрения:**
- **Объем данных:** Сотни терабайт логов ежедневно
- **Равномерное распределение шардов:** ClickHouse равномерно распределяет данные по шардам
- **Гибкая схема:** Поддержка изменяющихся структур логов без конфликтов типов
- **Реальное время:** Отладка, устранение неполадок и аналитика в режиме реального времени

**Архитектурные решения:**
- Распределенная архитектура с автоматическим балансированием нагрузки
- Высокопроизводительные алгоритмы сжатия данных
- Векторизованное выполнение запросов

### **3. Badoo (Bumble Group)**

**Специфика проекта:**  
Badoo использует ClickHouse для хранения и обработки событий из различных систем, предоставляя данные для мониторинга метрик и сложной аналитики. ClickHouse интегрирован с Apache Airflow для оркестрации ETL-процессов и с BI-инструментами (Superset, Tableau) для визуализации данных.

**Бизнес-потребность:**  
Аналитика пользовательской активности и продуктовой отчетности для разных команд и сервисов, обработка событий с задержкой менее минуты.

**Особенности внедрения и архитектуры:**  
- Шардирование данных по кластерам ClickHouse для масштабируемости.
- Интеграция с Apache Airflow и BI-инструментами (например, Superset, Tableau).
- Использование материализованных представлений и гибких агрегатов для разных команд продукта.
- Высокая скорость выполнения запросов даже на петабайтах данных.

### **4. Okko (Rambler Group)**

**Специфика проекта:**  
Okko использует ClickHouse для оперативной обработки потоковых данных о просмотрах, паузах и перемотках видео, что позволяет быстро получать аналитику для внутренних и внешних пользователей.

**Бизнес-потребность:**  
Оперативная аналитика просмотров видео, отчетность для правообладателей и внутреннего контроля качества контента, а также анализ пользовательских паттернов.

**Особенности внедрения и архитектуры:**  
- Построение витрин данных и материализованных представлений для ускорения отчетности.
- Масштабирование кластера ClickHouse по мере роста числа пользователей.
- Интеграция с BI и внешними аналитическими системами.
- Использование функций ClickHouse для обработки потоковых событий (например, live просмотров, пауз, перемоток).

### **5. Tencent - Аналитика и предоставление услуг**

**Специфика проекта**:
Китайский технологический гигант Tencent применяет ClickHouse в двух ключевых направлениях: как основу для облачного сервиса TCHouse-C (Tencent Cloud Data Warehouse) и в продуктах Tencent Music Entertainment для обработки музыкальной аналитики.

**Облачная платформа TCHouse-C**:
Tencent Cloud разработал полностью управляемый облачный сервис на базе ClickHouse, который обеспечивает создание хранилища данных масштаба терабайт-петабайт за считанные минуты. Платформа поддерживает массивно-параллельную обработку (MPP) и может обрабатывать запросы в несколько раз быстрее традиционных хранилищ данных - до терабайт данных в секунду на запрос.

**Особенности архитектуры**: 
- **Разделение вычислений и хранения**: кластеры TCHouse-C настраиваются отдельно для узлов хранения и вычислений, что позволяет масштабировать их независимо для снижения затрат
- **Высокая доступность**: каждый шард имеет две реплики для обеспечения доступности кластера в случае отказа одной из них
- **Безопасность**: кластеры развертываются в изолированных VPC для более безопасного доступа к данным

**Tencent Music Entertainment**: Компания использовала ClickHouse для обработки данных музыкальной платформы в составе гибридной архитектуры. Данные импортировались из Tencent Data Warehouse (TDW) в плоские таблицы, которые затем загружались в ClickHouse для аналитики и в Elasticsearch для поиска и таргетинга. Позднее TME мигрировала с ClickHouse на Apache Doris для унификации архитектуры.

**Масштабы внедрения**: 
- TCHouse-C обслуживает корпоративных клиентов с петабайтными объемами данных
- Поддержка сценариев business intelligence (BI), real-time аналитики и исследования данных
- Анализ поведения пользователей, корпоративной операционной деятельности

**Вклад в развитие**:
Tencent входит в топ-5 контрибьютеров ClickHouse, заняв 4-е место среди мирового сообщества по количеству принятых Pull Requests в 2023 году. Компания активно участвует в развитии проекта, обеспечивая совместимость и стабильность ClickHouse для облачных сред.

**Конкурентные преимущества**: TCHouse-C использует 10-кратный алгоритм сжатия данных ClickHouse для эффективного снижения использования дискового пространства и затрат по сравнению с традиционными хранилищами данных. Сервис обеспечивает линейное масштабирование вычислительных мощностей и хранения благодаря распределенной MPP-архитектуре.

---

## Дополнительные вопросы

### **1. К каким классам систем относится ClickHouse?**

ClickHouse относится к следующим классам систем:
- **OLAP (Online Analytical Processing)** - основное назначение для аналитической обработки данных
- **Колоночная СУБД** - данные хранятся по столбцам, а не по строкам
- **Распределенная система** - поддержка горизонтального масштабирования
- **MPP (Massively Parallel Processing)** - массивно-параллельная обработка данных
- **Real-time аналитика** - обработка данных в режиме реального времени с задержкой менее секунды

### **2. Какую проблему вы бы решили используя ClickHouse, а какую бы не стали?**

**Задачи, подходящие для ClickHouse:**
- Аналитика веб-трафика и журналов событий
- Обработка временных рядов и IoT данных  
- Fraud detection в финансовых системах
- A/B тестирование и анализ поведения пользователей
- Мониторинг производительности и observability
- Построение дашбордов реального времени
- ETL процессы с большими объемами данных

**Задачи, НЕ подходящие для ClickHouse:**
- OLTP системы с частыми UPDATE/DELETE операциями
- Приложения, требующие ACID транзакций
- Системы с большим количеством JOIN операций между таблицами
- Высококонкурентные системы с тысячами одновременных сессий
- Проекты с мутабельными данными, требующими частых изменений
- Небольшие объемы данных (менее миллионов записей)

### **3. Где можно получить помощь по ClickHouse и куда сообщать о багах?**

**Официальная поддержка:**
- **ClickHouse Cloud Support:** Для пользователей облачной версии через консоль (Help -> Support)
- **Enterprise Support:** 24/7 техническая поддержка для корпоративных клиентов
- **Официальный сайт:** https://clickhouse.com/support/program

**Сообщество и ресурсы:**
- **GitHub репозиторий:** https://github.com/ClickHouse/ClickHouse - для багрепортов и feature requests
- **Community Slack:** Публичный канал для пользователей Slack
- **Telegram группы:**
  - Русскоязычная: "ClickHouse не тормозит" (4,629+ участников)
  - Англоязычная: "ClickHouse" (1,286+ участников)
- **Документация:** https://clickhouse.com/docs/
- **Форумы и meetups:** Регулярные встречи в различных городах
- **YouTube каналы:** Технические вебинары и презентации

**Reporting багов:**
- **GitHub Issues:** https://github.com/ClickHouse/ClickHouse/issues
- **Community каналы:** Предварительное обсуждение в Telegram/Slack
- **Support case:** Для коммерческих пользователей через официальную поддержку

---

## Материалы

### Статьи
* [HTTP Analytics for 6M requests per second using ClickHouse - Cloudflare](https://blog.cloudflare.com/http-analytics-for-6m-requests-per-second-using-clickhouse/)
* [ClickHouse Architecture Overview](https://clickhouse.com/docs/academic_overview)
* [Who is using ClickHouse?](https://clickhouse.com/docs/faq/general/who-is-using-clickhouse)
* [Uber's Secret to Handle Millions of Logs per second with ClickHouse](https://favtutor.com/articles/uber-clickhouse/)
* [Fast, Scalable and Reliable Logging at Uber with Clickhouse](https://presentations.clickhouse.com/meetup40/uber.pdf)
* [ClickHouse within GitLab](https://docs.gitlab.com/development/database/clickhouse/clickhouse_within_gitlab/)
* [ClickHouse in the Cloud at Cloudflare](https://blog.cloudflare.com/clickhouse-in-the-cloud/)
* [ClickHouse blog: Badoo](https://clickhouse.com/blog/badoo/)
* [Okko case на официальном сайте ClickHouse](https://clickhouse.com/docs/ru/use_cases/okko/)
* [Tencent data engineer: why we went from ClickHouse to Apache Doris?](https://doris.apache.org/blog/Tencent-Data-Engineers-Why-We-Went-from-ClickHouse-to-Apache-Doris)
* [How does Tencent Cloud TCHouse-C choose the ClickHouse engine version?](https://www.tencentcloud.com/techpedia/109604)
* [Tencent. Cloud Data Warehouse. Product Introduction. Product Documentation](https://staticintl.cloudcachetci.com/doc/pdf/product/pdf/1129_44395_en.pdf)

### Видео 

[![How ClickHouse powers Netflix, Uber and Spotify's Analytics](https://img.youtube.com/vi/HRh5setqGCU/0.jpg)](https://www.youtube.com/watch?v=HRh5setqGCU)

### Дополнительные ресурсы
* [ClickHouse Support Program](https://clickhouse.com/support/program)
* [ClickHouse Community Resources](https://altinity.com/blog/the-clickhouse-community)
* [Making the Journey to FedRAMP: Cisco Umbrella and ClickHouse](https://altinity.com/events/making-the-journey-to-fedramp-cisco-umbrella-altinity-and-clickhouse-based-analytics/)