# Homework #12: RBAC –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞, –∫–≤–æ—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ —Ü–µ–ª–∏](#–æ–ø–∏—Å–∞–Ω–∏–µ-–∑–∞–¥–∞–Ω–∏—è-–∏-—Ü–µ–ª–∏)
- [–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞](#—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è-—Å–ø—Ä–∞–≤–∫–∞)
- [–ß–∞—Å—Ç—å 1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è: RBAC](#—á–∞—Å—Ç—å-1-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è-–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ-–∑–∞–¥–∞–Ω–∏—è-rbac)
  - [1.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è](#11-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
  - [1.2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#12-—Å–æ–∑–¥–∞–Ω–∏–µ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
  - [1.3. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏ –∏ –≤—ã–¥–∞—á–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π](#13-—Å–æ–∑–¥–∞–Ω–∏–µ-—Ä–æ–ª–∏-–∏-–≤—ã–¥–∞—á–∞-–ø—Ä–∏–≤–∏–ª–µ–≥–∏–π)
  - [1.4. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é](#14-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-—Ä–æ–ª–∏-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
  - [1.5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π](#15-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Å–æ–∑–¥–∞–Ω–Ω—ã—Ö-—Å—É—â–Ω–æ—Å—Ç–µ–π)
  - [1.6. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞](#16-—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ-–æ—Ç—á–µ—Ç–∞)
- [–ß–∞—Å—Ç—å 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è](#—á–∞—Å—Ç—å-2-–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ-–º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏-—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Ä–µ—Å—É—Ä—Å–∞–º–∏-–∏-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)
  - [2.1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫](#21-—Å–æ–∑–¥–∞–Ω–∏–µ-–∏–µ—Ä–∞—Ä—Ö–∏–∏-–ø—Ä–æ—Ñ–∏–ª–µ–π-–Ω–∞—Å—Ç—Ä–æ–µ–∫)
  - [2.2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–≤–æ—Ç—ã](#22-—Å–æ–∑–¥–∞–Ω–∏–µ-–∏-–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ-–∫–≤–æ—Ç—ã)
  - [2.3. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π](#23-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-–ø—Ä–æ—Ñ–∏–ª—è-–∏-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
  - [2.4. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ —Ç–∏—Ä–∞–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫](#24-–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è-–∏-—Ç–∏—Ä–∞–∂–∏—Ä–æ–≤–∞–Ω–∏–µ-–Ω–∞—Å—Ç—Ä–æ–µ–∫)
- [–û–±—â–∏–µ –≤—ã–≤–æ–¥—ã –ø–æ –∑–∞–¥–∞–Ω–∏—é](#–æ–±—â–∏–µ-–≤—ã–≤–æ–¥—ã-–ø–æ-–∑–∞–¥–∞–Ω–∏—é)
- [–°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤](#—Å–ø–∏—Å–æ–∫-–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤)

---

## –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ —Ü–µ–ª–∏

–í –¥–∞–Ω–Ω–æ–º –¥–æ–º–∞—à–Ω–µ–º –∑–∞–¥–∞–Ω–∏–∏ –±—É–¥–µ—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∞ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è Role-Based Access Control (RBAC), –∞ —Ç–∞–∫–∂–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∫–≤–æ—Ç –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –≤ ClickHouse. –≠—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —è–≤–ª—è—é—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º.

**–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –æ—Ç—Ä–∞–±–æ—Ç–∞–Ω—ã:**
-   –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ä–æ–ª—è–º–∏, –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –∏ –∫–≤–æ—Ç–∞–º–∏.
-   –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
-   –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã.

---

## –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞
**RBAC (Role-Based Access Control)** ‚Äî —ç—Ç–æ –º–æ–¥–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Ä–æ–ª—è—Ö. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤—ã–¥–∞–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç —Ä–æ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `developer`, `analyst`), –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–ª—è –Ω–∏—Ö –Ω–∞–±–æ—Ä –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π, –∞ –∑–∞—Ç–µ–º –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —ç—Ç–∏ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

**–ü—Ä–æ—Ñ–∏–ª–∏ –∏ –∫–≤–æ—Ç—ã** –≤ ClickHouse –ø–æ–∑–≤–æ–ª—è—é—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤. –ü—Ä–æ—Ñ–∏–ª–∏ (`SETTINGS PROFILE`) –∑–∞–¥–∞—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `max_memory_usage`), –∞ –∫–≤–æ—Ç—ã (`QUOTA`) ‚Äî –Ω–∞ —Å–æ–≤–æ–∫—É–ø–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å).

---

## –ß–∞—Å—Ç—å 1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è: RBAC

### 1.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–î–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–ª–∞—Å—Ç–µ—Ä ClickHouse, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π —Å –ø–æ–º–æ—â—å—é Terraform –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `base-infra`.
```sh
cd base-infra/clickhouse
terraform apply -auto-approve
```
> ‚ö†Ô∏è –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `TF_VAR_super_user_name`, `TF_VAR_super_user_password` –∏ `TF_VAR_bi_user_password` –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ DDL/DML –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å –ø–µ—Ä–≤–æ–≥–æ —É–∑–ª–∞ (`clickhouse-01`).

### 1.2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `jhon` —Å –ø–∞—Ä–æ–ª–µ–º `qwerty`. –ö–æ–º–∞–Ω–¥–∞ `ON CLUSTER` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞.
```sql
CREATE USER IF NOT EXISTS jhon ON CLUSTER dwh_test IDENTIFIED BY 'qwerty';
```
*–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:*

<img src="../screenshots/hw12_rbac-quotas-limits/01_create_user.png" alt="–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" width="600"/>

### 1.3. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏ –∏ –≤—ã–¥–∞—á–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —Ä–æ–ª—å `devs` –∏ –µ–π –±—É–¥—É—Ç –≤—ã–¥–∞–Ω—ã –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ (`SELECT`) –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `system.parts`.
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏ –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞
CREATE ROLE IF NOT EXISTS devs ON CLUSTER dwh_test;

-- –í—ã–¥–∞—á–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π —Ä–æ–ª–∏ –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞
GRANT SELECT ON system.parts TO devs ON CLUSTER dwh_test;
```
*–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–ª–∏ –∏ –≤—ã–¥–∞—á–∏ –ø—Ä–∞–≤:*

<img src="../screenshots/hw12_rbac-quotas-limits/02_create_role_grant.png" alt="–°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏ –∏ –≤—ã–¥–∞—á–∞ –ø—Ä–∞–≤" width="600"/>

### 1.4. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `jhon` –±—É–¥–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Ä–æ–ª—å `devs`.
```sql
GRANT devs TO jhon ON CLUSTER dwh_test;
```
*–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–∏:*

<img src="../screenshots/hw12_rbac-quotas-limits/03_grant_role_to_user.png" alt="–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é" width="600"/>

### 1.5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã `system.users`, `system.roles` –∏ `system.grants`.

1.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
    ```sql
    SELECT name FROM system.users WHERE name = 'jhon';
    ```
2.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏:**
    ```sql
    SELECT name FROM system.roles WHERE name = 'devs';
    ```
3.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–¥–∞–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
    ```sql
    SELECT * FROM system.role_grants WHERE user_name = 'jhon';
    ```
4.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π, –≤—ã–¥–∞–Ω–Ω—ã—Ö —Ä–æ–ª–∏:**
    ```sql
    SELECT * FROM system.grants WHERE role_name = 'devs';
    ```
*–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:*

<img src="../screenshots/hw12_rbac-quotas-limits/04_check_system_tables.png" alt="–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü" width="800"/>

> **üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º:**
> –ó–¥–µ—Å—å —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è `NULL` –≤ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö:
> - –í `system.role_grants` –∞—Ç—Ä–∏–±—É—Ç `role_name` –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `NULL`, —Ç–∞–∫ –∫–∞–∫ —Ä–æ–ª—å `devs` –±—ã–ª–∞ –≤—ã–¥–∞–Ω–∞ –Ω–∞–ø—Ä—è–º—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `jhon`, –∞ –Ω–µ —á–µ—Ä–µ–∑ –¥—Ä—É–≥—É—é —Ä–æ–ª—å.
> - –í `system.grants` –∞—Ç—Ä–∏–±—É—Ç `user_name` –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `NULL`, —Ç–∞–∫ –∫–∞–∫ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è `SELECT` –±—ã–ª–∞ –≤—ã–¥–∞–Ω–∞ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Ä–æ–ª–∏ `devs`, –∞ –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
>
> –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ ClickHouse —Ä–∞–∑–¥–µ–ª—è–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏ –ø—Ä–∞–≤.

### 1.6. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
–î–ª—è —Å–¥–∞—á–∏ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ DDL-–∑–∞–ø—Ä–æ—Å—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏–∑ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü.

–°–ª–µ–¥—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞, –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `terraform`, —Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ Markdown:
```bash
# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
mkdir -p ../../materials/hw12_rbac-quotas-limits

# –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç
(
    echo "## 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è jhon"
    echo '```sql'
    echo "CREATE USER IF NOT EXISTS jhon ON CLUSTER dwh_test IDENTIFIED BY 'qwerty';"
    echo '```'
    echo -e "\n## 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–ª–∏ devs –∏ –≤—ã–¥–∞—á–∞ –ø—Ä–∞–≤"
    echo '```sql'
    echo "CREATE ROLE IF NOT EXISTS devs ON CLUSTER dwh_test;"
    echo "GRANT SELECT ON system.parts TO devs ON CLUSTER dwh_test;"
    echo '```'
    echo -e "\n## 3. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"
    echo '```sql'
    echo "GRANT devs TO jhon ON CLUSTER dwh_test;"
    echo '```'
    echo -e "\n## 4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–æ–∫"
    echo '### system.role_grants'
    echo '```'
    docker exec clickhouse-01 clickhouse-client --user ${TF_VAR_super_user_name} --password ${TF_VAR_super_user_password} --query "SELECT * FROM system.role_grants WHERE user_name = 'jhon';" --vertical
    echo '```'
    echo '### system.grants'
    echo '```'
    docker exec clickhouse-01 clickhouse-client --user ${TF_VAR_super_user_name} --password ${TF_VAR_super_user_password} --query "SELECT * FROM system.grants WHERE role_name = 'devs';" --vertical
    echo '```'
) > ../../materials/hw12_rbac-quotas-limits/result.md
```
> –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–∞–π–ª–µ: [`result.md`](../materials/hw12_rbac-quotas-limits/result.md).

---

## –ß–∞—Å—Ç—å 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–í —Ä–∞–º–∫–∞—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —è–≤–ª—è—é—Ç—Å—è –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è production-–∫–ª–∞—Å—Ç–µ—Ä–æ–º.

### 2.1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫
–ü—Ä–æ—Ñ–∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–∑–≤–æ–ª—è—é—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (`INHERIT`) –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –≥–∏–±–∫–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏.

1.  **–°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è `readonly_profile`:**
    –≠—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ª—é–±—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫—Ä–æ–º–µ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
    ```sql
    CREATE SETTINGS PROFILE IF NOT EXISTS readonly_profile ON CLUSTER dwh_test
        SETTINGS readonly = 1;
    ```
2.  **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è `analytics_profile` —Å –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º:**
    –≠—Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å –Ω–∞—Å–ª–µ–¥—É–µ—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç `readonly_profile` –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
    ```sql
    CREATE SETTINGS PROFILE IF NOT EXISTS analytics_profile ON CLUSTER dwh_test
        SETTINGS max_memory_usage = '1G',
                 max_execution_time = 300
        INHERIT 'readonly_profile';
    ```
> **üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π (`INHERIT`) –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –≥–∏–±–∫–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –∏–∑–±–µ–≥–∞—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫.
> –ó–¥–µ—Å—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∂–µ—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (10 —Å–µ–∫—É–Ω–¥) –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –û–ó–£ (1 –ì–ë) –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
> –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø—Ä–æ—Ñ–∏–ª—è—Ö –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://clickhouse.com/docs/ru/sql-reference/statements/create/settings-profile).

*–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π:*

<img src="../screenshots/hw12_rbac-quotas-limits/05_create_profiles.png" alt="–°–æ–∑–¥–∞–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π" width="600"/>

### 2.2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–≤–æ—Ç—ã
–ö–≤–æ—Ç—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç –∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—Ä–µ–º–µ–Ω–∏. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –∏—Å—á–µ—Ä–ø–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –æ–¥–Ω–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏–ª–∏ —Ä–æ–ª—å—é.
```sql
CREATE QUOTA IF NOT EXISTS analytics_quota ON CLUSTER dwh_test
    FOR INTERVAL 1 HOUR MAX queries = 100, read_bytes = '5G'
    TO devs;
```
> **üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–∞ –∫–≤–æ—Ç–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ä–æ–ª—å `devs` 100 –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ 5 –ì–ë –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —á–∞—Å.

*–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–≤–æ—Ç—ã:*

<img src="../screenshots/hw12_rbac-quotas-limits/06_create_quota.png" alt="–°–æ–∑–¥–∞–Ω–∏–µ –∫–≤–æ—Ç—ã" width="600"/>

### 2.3. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
1.  **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è `analytics_profile` —Ä–æ–ª–∏ `devs`:**
    ```sql
    ALTER ROLE devs ON CLUSTER dwh_test SETTINGS PROFILE 'analytics_profile';
    ```
2.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `jhon`:**
    –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `INSERT` –æ—Ç –∏–º–µ–Ω–∏ `jhon` –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –æ—à–∏–±–∫–æ–π, —Ç–∞–∫ –∫–∞–∫ –µ–≥–æ —Ä–æ–ª—å `devs` –Ω–∞—Å–ª–µ–¥—É–µ—Ç `readonly=1`.
    ```sql
    -- –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É
    INSERT INTO otus_default.user_activity (user_id) VALUES (1);
    ```
*–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:*

<img src="../screenshots/hw12_rbac-quotas-limits/07_test_readonly.png" alt="–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ readonly –ø—Ä–æ—Ñ–∏–ª—è" width="800"/>

### 2.4. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏ —Ç–∏—Ä–∞–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
–ß—Ç–æ–±—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—Å–µ —à–∞–≥–∏ –≤—Ä—É—á–Ω—É—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é —Ä–æ–ª—å –¥–ª—è –∫–æ–º–∞–Ω–¥—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, `analytics_team`.

1.  **–°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Ä–æ–ª–∏ `analytics_team`:**
    ```sql
    CREATE ROLE IF NOT EXISTS analytics_team ON CLUSTER dwh_test;
    GRANT SELECT, INSERT, ALTER ON otus_default.* TO analytics_team ON CLUSTER dwh_test;
    
    -- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ –∫–≤–æ—Ç—ã –∫ –Ω–æ–≤–æ–π —Ä–æ–ª–∏
    ALTER ROLE analytics_team ON CLUSTER dwh_test SETTINGS PROFILE 'analytics_profile';
    ALTER QUOTA analytics_quota ON CLUSTER dwh_test TO analytics_team;
    ```

*–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–ª–∏ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫ –Ω–µ–π –ø—Ä–æ—Ñ–∏–ª—è –∏ –∫–≤–æ—Ç—ã:*

<img src="../screenshots/hw12_rbac-quotas-limits/08_complex_role_creation.png" alt="–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ä–æ–ª—å" width="800"/>

2.  **–°–æ–∑–¥–∞–Ω–∏–µ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `jane`:**
    ```sql
    CREATE USER IF NOT EXISTS jane ON CLUSTER dwh_test IDENTIFIED BY 'password123';
    GRANT analytics_team TO jane ON CLUSTER dwh_test;
    ```

*–†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Ä–æ–ª–∏ –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:*

<img src="../screenshots/hw12_rbac-quotas-limits/09_automation.png" alt="–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ä–æ–ª—å" width="800"/>

> **üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –¢–µ–ø–µ—Ä—å –¥–ª—è –ª—é–±–æ–≥–æ –Ω–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ–≥–æ –¥–≤–µ –∫–æ–º–∞–Ω–¥—ã. –í—Å–µ –ø—Ä–∞–≤–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Ä–æ–ª—å.

3.  **–°–æ–∑–¥–∞–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Ä–æ–ª–µ–π:**
    –ß—Ç–æ–±—ã –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ `system.role_grants` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å, —Å–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—É—é —Ä–æ–ª—å `analytics_team_lead` –∏ –Ω–∞–∑–Ω–∞—á–∏–º –µ–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–æ–ª—å `analytics_team`.
    ```sql
    CREATE ROLE IF NOT EXISTS analytics_team_lead ON CLUSTER dwh_test;
    GRANT analytics_team TO analytics_team_lead ON CLUSTER dwh_test;
    ```
    > **üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏:** –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å "—Ä–æ–ª–∏-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã". –ù–∞–ø—Ä–∏–º–µ—Ä, `analytics_team_lead` –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –≤—Å–µ –ø—Ä–∞–≤–∞ `analytics_team` –ø–ª—é—Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ, —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `DROP TABLE`). –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –¥–ª—è —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π –∫–æ–º–∞–Ω–¥, –Ω–µ –¥—É–±–ª–∏—Ä—É—è –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞.
4.  **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `peter` –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –µ–º—É —Ä–æ–ª–∏-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
    ```sql
    CREATE USER IF NOT EXISTS peter ON CLUSTER dwh_test IDENTIFIED BY 'new_password';
    GRANT analytics_team_lead TO peter ON CLUSTER dwh_test;
    ```
5.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏:**
    –¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –≥—Ä–∞–Ω—Ç—ã –¥–ª—è `analytics_team_lead`, `role_name` –±—É–¥–µ—Ç `NULL`, –Ω–æ –µ—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –≥—Ä–∞–Ω—Ç—ã –¥–ª—è `analytics_team`, `role_name` –±—É–¥–µ—Ç `analytics_team_lead`.
    ```sql
    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–æ–º—É –∏ –∫–∞–∫ –≤—ã–¥–∞–Ω–∞ —Ä–æ–ª—å analytics_team
    SELECT * FROM system.role_grants WHERE granted_role_name = 'analytics_team';
    ```
    > **üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–∫–∞–∂–µ—Ç –¥–≤–µ –∑–∞–ø–∏—Å–∏. –í –æ–¥–Ω–æ–π (`user_name` = 'jane') `role_name` –±—É–¥–µ—Ç `NULL` (–ø—Ä—è–º–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ). –í –¥—Ä—É–≥–æ–π (`role_name` = 'analytics_team_lead') `user_name` –±—É–¥–µ—Ç `NULL`, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å —Ä–æ–ª–µ–π.

*–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Ä–æ–ª–µ–π:*

<img src="../screenshots/hw12_rbac-quotas-limits/10_check_role_hierarchy.png" alt="–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–µ—Ä–∞—Ä—Ö–∏–∏ —Ä–æ–ª–µ–π" width="800"/>

---

## –û–±—â–∏–µ –≤—ã–≤–æ–¥—ã –ø–æ –∑–∞–¥–∞–Ω–∏—é
–í —Ö–æ–¥–µ —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –±—ã–ª–∏ –æ—Å–≤–æ–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –¥–æ—Å—Ç—É–ø–æ–º –∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –≤ ClickHouse. –ë—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Ä–æ–ª—å, –∏–µ—Ä–∞—Ä—Ö–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π –∏ –∫–≤–æ—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è. –≠—Ç–æ—Ç –º–µ—Ö–∞–Ω–∏–∑–º —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –ª—é–±–æ–π production-—Å–∏—Å—Ç–µ–º–µ.

## –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ClickHouse: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏](https://clickhouse.com/docs/ru/operations/access-rights)
